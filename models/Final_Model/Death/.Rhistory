tl  <- attr(terms(fml), "term.labels")
new_terms <- vapply(tl, function(term){
if (!grepl("^ns\\(", term)) return(term)
vname <- .parse_var_from_ns(term)
spec  <- .find_spec_by_var(bd$spline_spec, vname)
if (is.null(spec)) stop(sprintf("spline_spec에서 '%s' 스펙을 못 찾음 (term=%s)", vname, term))
knots <- spec$knots %||% spec$Knots %||% spec$inner_knots
bnd   <- spec$Boundary.knots %||% spec$Boundary_knots %||% spec$boundary
knots <- as.numeric(knots); bnd <- as.numeric(bnd)
if (length(bnd) < 2) stop(sprintf("Boundary.knots 누락: var=%s", vname))
paste0(
"splines::ns(", vname,
if (length(knots)) paste0(", knots=c(", paste(signif(knots,10), collapse=","), ")") else "",
", Boundary.knots=c(", signif(bnd[1],10), ",", signif(bnd[2],10), ")",
", intercept=FALSE)"
)
}, character(1))
rhs_new <- paste(new_terms, collapse=" + ")
as.formula(paste(lhs, "~", rhs_new), env = parent.frame())
}
rename_ns_to_train <- function(X_names, want){
train_ns <- grep("^ns\\(", want, value = TRUE)
train_map <- list()
if (length(train_ns)) {
vars_tr <- vapply(train_ns, .parse_var_from_ns, "", USE.NAMES = FALSE)
idx_tr  <- vapply(train_ns, .parse_idx_from_ns, NA_integer_, USE.NAMES = FALSE)
for (v in unique(vars_tr[!is.na(vars_tr)])) {
sel <- which(vars_tr == v & !is.na(idx_tr))
ord <- sel[order(idx_tr[sel])]
train_map[[v]] <- train_ns[ord]
}
}
pred_ns <- grep("(^|::)ns\\(", X_names, value = TRUE)
if (!length(pred_ns)) return(X_names)
vars_pr <- vapply(pred_ns, .parse_var_from_ns, "", USE.NAMES = FALSE)
idx_pr  <- vapply(pred_ns, .parse_idx_from_ns, NA_integer_, USE.NAMES = FALSE)
for (v in unique(vars_pr[!is.na(vars_pr)])) {
psel <- which(vars_pr == v & !is.na(idx_pr))
pord <- psel[order(idx_pr[psel])]
pgrp <- pred_ns[pord]
tgrp <- train_map[[v]]
if (length(tgrp)) {
ti <- vapply(tgrp, .parse_idx_from_ns, NA_integer_)
pi <- vapply(pgrp, .parse_idx_from_ns, NA_integer_)
common <- intersect(ti, pi)
if (length(common)) {
for (k in common) {
from <- pgrp[which(pi == k)]
to   <- tgrp[which(ti == k)]
pos  <- match(from, X_names)
if (!is.na(pos) && length(to) == 1) X_names[pos] <- to
}
}
}
}
X_names
}
predict_by_coef <- function(bd, newdata, strict = TRUE, return_debug = TRUE){
stopifnot(is.data.frame(newdata))
if (is.null(bd)) return(list(error="Model bundle is NULL (path missing)."))
df <- .align_factors(newdata, bd$factor_spec)
fml_use <- rebuild_formula_strong(bd)
tt <- terms(fml_use)
mf <- model.frame(stats::delete.response(tt), data = df, na.action = na.omit)
if (nrow(mf) == 0) {
if (return_debug) return(list(prob_14d_death = numeric(0), debug = list(reason="empty model.frame")))
return(numeric(0))
}
Xp <- model.matrix(stats::delete.response(tt), data = mf)
if ("(Intercept)" %in% colnames(Xp)) Xp <- Xp[, setdiff(colnames(Xp), "(Intercept)"), drop = FALSE]
want <- bd$x_names %||% colnames(Xp)
colnames(Xp) <- rename_ns_to_train(colnames(Xp), want)
miss_before  <- setdiff(want, colnames(Xp))
extra_before <- setdiff(colnames(Xp), want)
still_ns_miss <- grep("^ns\\(", miss_before, value = TRUE)
if (strict && length(still_ns_miss)) {
return(list(
error = sprintf("스플라인 열 매핑 실패: %s", paste(still_ns_miss, collapse=", ")),
debug = list(
miss_before = miss_before,
extra_before = extra_before,
want_head = head(want, 30),
X_pred_head = head(colnames(Xp), 30)
)
))
}
if (length(miss_before)) {
add <- matrix(0, nrow = nrow(Xp), ncol = length(miss_before))
colnames(add) <- miss_before
Xp <- cbind(Xp, add)
}
if (length(extra_before)) Xp <- Xp[, setdiff(colnames(Xp), extra_before), drop = FALSE]
Xp <- Xp[:, want, drop = FALSE]
# -----------------------------
# Outcome / Model routing
# -----------------------------
.normalize_model_base <- function(m){
m <- tolower(m %||% "clinical_base")
if (m %in% c("base","clinical_base")) return("clinical_base")
if (m %in% c("alt","alternative","clinical_alt")) return("clinical_alt")
if (m %in% c("ct","ct_base")) return("ct_base")
if (m %in% c("ct_alt","ct_alternative","alternative_ct")) return("ct_alt")
if (m %in% c("full","full_base")) return("full_base")
if (m %in% c("full_alt","full_alternative","alternative_full")) return("full_alt")
"clinical_base"
}
normalize_outcome <- function(outcome){
o <- tolower(outcome %||% "death14")
if (o %in% c("death","death14","14d","14-day","14_day")) return("death14")
if (o %in% c("3m","3mo","3month","3-month","3_month"))   return("3m")
if (o %in% c("6m","6mo","6month","6-month","6_month"))   return("6m")
if (o %in% c("12m","12mo","12month","12-month","12_month")) return("12m")  # ← NEW
"death14"
}
pick_key2 <- function(model, outcome=NULL){
base <- .normalize_model_base(model)
oc   <- normalize_outcome(outcome)
if (oc == "death14") return(base)
paste0(oc, "_", base)  # e.g., "12m_full_alt"
}
outcome_label <- function(outcome){
oc <- normalize_outcome(outcome)
if (oc == "3m")  return("3-Month Unfavorable Outcome")
if (oc == "6m")  return("6-Month Unfavorable Outcome")
if (oc == "12m") return("12-Month Unfavorable Outcome")  # ← NEW
"14 Day Death"
}
model_label <- function(key, outcome=NULL){
oc <- outcome_label(outcome)
base <- sub("^(3m|6m|12m)_", "", key)  # ← NEW: 12m 포함
mdl <- switch(base,
clinical_base = "AJOU-Clinical (Base)",
clinical_alt  = "AJOU-Clinical (Alternative)",
ct_base       = "AJOU-CT (Base)",
ct_alt        = "AJOU-CT (Alternative)",
full_base     = "AJOU-Full (Base)",
full_alt      = "AJOU-Full (Alternative)",
"AJOU-Clinical (Base)"
)
paste(mdl, "·", oc)
}
# -----------------------------
# META helpers
# -----------------------------
extract_lab_boundaries <- function(bd){
res <- list()
ss  <- bd$spline_spec %||% list()
if (!length(ss)) return(res)
get_var <- function(nm, obj){
v <- obj$var %||% obj$variable
if (!is.null(v)) return(gsub("`","", v))
vv <- .parse_var_from_ns(nm)
if (!is.na(vv)) return(vv)
NA_character_
}
for (nm in names(ss)) {
sp <- ss[[nm]]
v  <- get_var(nm, sp)
if (is.na(v) || is.null(v)) next
bnd <- sp$Boundary.knots %||% sp$Boundary_knots %||% sp$boundary
bnd <- as.numeric(bnd)
if (is.numeric(bnd) && length(bnd) >= 2) res[[v]] <- list(boundary = unname(bnd[1:2]))
}
res
}
display_name_map <- list(
contusion = "Contusion",
MidlineShift = "Midline shift",
basal_cistern_compression = "Cisternal compression",
"Alk.Phosphatase" = "Alkaline Phosphatase",
Upper_Lower_Extremities_imputed = "Quadriplegia",
facial_fracture = "Facial fracture"   # ← NEW (12m CT Base에서 사용)
)
ui_overrides_map <- list(
Upper_Lower_Extremities_imputed = list(
type = "quadriplegia",
yes  = "Both Bilateral",
no   = "Preserved"
)
)
# -----------------------------
# META
# -----------------------------
#* @get /meta
function(model = "clinical_base", outcome = "death14") {
key <- pick_key2(model, outcome)
bd  <- bundle[[key]]
if (is.null(bd)) return(list(error=sprintf("Unknown or missing model/outcome: %s / %s", model, outcome)))
vars <- bd$var_spec
if (is.null(vars) || length(vars) == 0) vars <- make_var_spec(bd)
fml <- bd$formula
lhs <- as.character(fml)[2]
allv <- setdiff(all.vars(fml), lhs)
list(
target        = outcome_label(outcome),
outcome_id    = normalize_outcome(outcome),
model_key     = key,
model_id      = model_label(key, outcome),
variables     = vars,
factor_spec   = bd$factor_spec %||% list(),
formula_vars  = allv,
lab_boundaries= extract_lab_boundaries(bd),
display_names = display_name_map,
ui_overrides  = ui_overrides_map
)
}
# -----------------------------
# COEF
# -----------------------------
#* @get /coef
function(model = "clinical_base", outcome = "death14"){
key <- pick_key2(model, outcome)
bd  <- bundle[[key]]
if (is.null(bd)) return(list(error=sprintf("Unknown or missing model/outcome: %s / %s", model, outcome)))
data.frame(feature = bd$coef_names, coef = bd$coef_dense, stringsAsFactors = FALSE)
}
# -----------------------------
# PREDICT
# -----------------------------
#* @post /predict
function(req) {
body <- tryCatch(jsonlite::fromJSON(req$postBody, simplifyVector = TRUE), error=function(e) NULL)
if (is.null(body) || is.null(body$data)) return(list(error="JSON with 'data': [ {...} ] and optional 'model','outcome'"))
key <- pick_key2(body$model %||% "clinical_base", body$outcome %||% "death14")
thr <- body$threshold %||% 0.5
df  <- as.data.frame(body$data, stringsAsFactors = FALSE)
bd  <- bundle[[key]]
out <- predict_by_coef(bd, df, strict = TRUE, return_debug = TRUE)
if (!is.null(out$error)) return(c(list(model_key=key, model_id=model_label(key, body$outcome)), out))
p <- if (is.list(out)) out$prob_14d_death else out
y <- ifelse(is.na(p), NA_integer_, as.integer(p >= thr))
res <- list(
model_key = key,
model_id  = model_label(key, body$outcome),
prob_14d_death = p,
pred_0_1 = y
)
if (is.list(out) && !is.null(out$debug)) res$debug <- out$debug
res
}
pr("C:/Users/niced/Desktop/TBI_risk_factor_R/소스코드/AJOU_Webpage/api/Plumber_4.R") |>
pr_set_docs(FALSE) |>              # ← Swagger/OpenAPI 비활성화
pr_set_debug(FALSE) |>
pr_run(host="0.0.0.0", port=8000)
# -----------------------------
# AJOU TBI · Plumber API
#  - Outcomes:
#     * 14-day Death
#     * 3-Month Unfavorable Outcome
#     * 6-Month Unfavorable Outcome
#     * 12-Month Unfavorable Outcome   # ← NEW
#  - Models per outcome: Clinical(Base/Alt), CT(Base/Alt), Full(Base/Alt)
#  - Robust spline rebuild + exact ns() column renaming included
# -----------------------------
suppressPackageStartupMessages({
library(plumber)
library(jsonlite)
library(splines)
})
`%||%` <- function(a,b) if (is.null(a)) b else a
# ---- CORS
#* @filter cors
cors <- function(req, res){
if (req$REQUEST_METHOD == "OPTIONS") {
res$setHeader("Access-Control-Allow-Origin",  "*")
res$setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS")
req_hdrs <- req$HTTP_ACCESS_CONTROL_REQUEST_HEADERS %||% "Content-Type, Authorization"
res$setHeader("Access-Control-Allow-Headers", req_hdrs)
res$status <- 200
return()
}
res$setHeader("Access-Control-Allow-Origin", "*")
plumber::forward()
}
# -----------------------------
# Bundle paths (Death14 + 3Month + 6Month + 12Month)
# -----------------------------
paths <- list(
# ---- 14-day Death
clinical_base = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/Death/Clinical/Original/Clinical_Original_Death_Lasso_1se_bundle.rds",
clinical_alt  = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/Death/Clinical/Alternative/Clinical_A_Death_lasso_1se_bundle.rds",
ct_base       = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/Death/CT/Original/CT_Original_Death_EN_a0.6_1se_bundle.rds",
ct_alt        = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/Death/CT/Alternative/CT_A_Death_EN_a0.6_1se_bundle.rds",
full_base     = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/Death/Full/Original/Full_Original_Death_lasso_1se_bundle.rds",
full_alt      = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/Death/Full/Alternative/Full_A_Death_Lasso_1se_bundle.rds",
# ---- 3-Month Unfavorable Outcome
`3m_clinical_base` = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/3Month/Clinical/Original/Clinical_Original_3Month_Lasso_0.03_bundle.rds",
`3m_clinical_alt`  = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/3Month/Clinical/Alternative/Clinical_A_3Month_Lasso_0.03_bundle.rds",
`3m_ct_base`       = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/3Month/CT/Original/CT_Original_3Month_Lasso_0.025_bundle.rds",
`3m_ct_alt`        = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/3Month/CT/Alternative/CT_A_3Month_Lasso_0.025_bundle.rds",
`3m_full_base`     = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/3Month/Full/Original/Full_Original_3Month_Lasso_0.02_bundle.rds",
`3m_full_alt`      = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/3Month/Full/Alternative/Full_A_3Month_Lasso_0.02_bundle.rds",
# ---- 6-Month Unfavorable Outcome
`6m_clinical_base` = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/6Month/Clinical/Original/Clinical_Original_6Month_Lasso_0.025_bundle.rds",
`6m_clinical_alt`  = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/6Month/Clinical/Alternative/Clinical_A_6Month_Lasso_0.025_bundle.rds",
`6m_ct_base`       = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/6Month/CT/Original/CT_Original_6Month_EN_a0.3_l0.05_bundle.rds",
`6m_ct_alt`        = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/6Month/CT/Alternative/CT_A_6Month_EN_a0.3_l0.05_bundle.rds",
`6m_full_base`     = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/6Month/Full/Original/Full_Original_6Month_EN_a0.5_l0.04_bundle.rds",
`6m_full_alt`      = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/6Month/Full/Alternative/Full_A_6Month_EN_a0.5_l0.04_bundle.rds",
# ---- 12-Month Unfavorable Outcome  # ← NEW (네가 준 경로 그대로)
`12m_clinical_base` = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/12Month/Clinical/Original/Clinical_Original_12Month_lasso0.025_bundle.rds",
`12m_clinical_alt`  = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/12Month/Clinical/Alternative/Clinical_A_12Month_lasso0.025_bundle.rds",
`12m_ct_base`       = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/12Month/CT/Original/CT_Original_12Month_EN_a0.4_l0.04_bundle.rds",
`12m_ct_alt`        = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/12Month/CT/Alternative/CT_A_12Month_EN_a0.4_l0.04_bundle.rds",
`12m_full_base`     = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/12Month/Full/Original/Full_Original_12Month_ridge_0.08_bundle.rds",
`12m_full_alt`      = "C:/Users/niced/Desktop/TBI_risk_factor_R/Final_Model/12Month/Full/Alternative/Full_A_12Month_ridge_0.08_bundle.rds"
)
# --- 안전 로더
read_bundle_safe <- function(p, key){
if (!file.exists(p)) {
message(sprintf("[WARN] bundle path not found for key=%s :: %s", key, p))
return(NULL)
}
if (!grepl("\\.rds$", p, ignore.case = TRUE)) {
message(sprintf("[WARN] not an .rds file for key=%s :: %s (skipping)", key, p))
return(NULL)
}
tryCatch(readRDS(p),
error = function(e){
message(sprintf("[WARN] readRDS failed for key=%s :: %s", key, conditionMessage(e))); NULL
})
}
bundle <- setNames(vector("list", length(paths)), names(paths))
for (k in names(paths)) bundle[[k]] <- read_bundle_safe(paths[[k]], k)
# -----------------------------
# Helpers (동일)
# -----------------------------
make_var_spec <- function(bd){
fml <- bd$formula
lhs <- as.character(fml)[2]
allv <- setdiff(all.vars(fml), lhs)
fsp <- bd$factor_spec %||% list()
vars <- list()
for (nm in names(fsp)) {
vars[[length(vars)+1]] <- list(name = nm, type = "factor", levels = fsp[[nm]]$levels)
}
for (nm in setdiff(allv, names(fsp))) {
vars[[length(vars)+1]] <- list(name = nm, type = "numeric")
}
vars
}
.align_factors <- function(df, factor_spec) {
if (is.null(factor_spec)) return(df)
for (nm in names(factor_spec)) if (nm %in% names(df)) {
lv  <- factor_spec[[nm]]$levels
ref <- factor_spec[[nm]]$reference %||% lv[[1]]
df[[nm]] <- factor(as.character(df[[nm]]), levels = lv)
df[[nm]][is.na(df[[nm]])] <- ref
df[[nm]][!(df[[nm]] %in% lv)] <- ref
}
df
}
.parse_var_from_ns <- function(term){
s <- gsub("\\s+", "", term); s <- sub("^splines::","", s)
m <- regexec("^ns\\((`?[^,\\)`]+`?)[,\\)]", s)
r <- regmatches(s, m)[[1]]
if (length(r) >= 2) gsub("`","", r[2]) else NA_character_
}
.parse_idx_from_ns <- function(nm){
s <- gsub("\\s+", "", nm); s <- sub("^splines::","", s)
m <- regexec("\\)(\\d+)$", s); r <- regmatches(s, m)[[1]]
if (length(r) >= 2) as.integer(r[2]) else NA_integer_
}
.find_spec_by_var <- function(spline_spec, vname){
for (nm in names(spline_spec)) {
v_from_key <- .parse_var_from_ns(nm)
if (!is.na(v_from_key) && identical(v_from_key, vname)) return(spline_spec[[nm]])
}
if (vname %in% names(spline_spec)) return(spline_spec[[vname]])
for (nm in names(spline_spec)) {
sp <- spline_spec[[nm]]
v  <- sp$var %||% sp$variable
if (!is.null(v) && gsub("`","", v) == vname) return(sp)
}
NULL
}
rebuild_formula_strong <- function(bd){
fml <- bd$formula
lhs <- as.character(fml)[2]
tl  <- attr(terms(fml), "term.labels")
new_terms <- vapply(tl, function(term){
if (!grepl("^ns\\(", term)) return(term)
vname <- .parse_var_from_ns(term)
spec  <- .find_spec_by_var(bd$spline_spec, vname)
if (is.null(spec)) stop(sprintf("spline_spec에서 '%s' 스펙을 못 찾음 (term=%s)", vname, term))
knots <- spec$knots %||% spec$Knots %||% spec$inner_knots
bnd   <- spec$Boundary.knots %||% spec$Boundary_knots %||% spec$boundary
knots <- as.numeric(knots); bnd <- as.numeric(bnd)
if (length(bnd) < 2) stop(sprintf("Boundary.knots 누락: var=%s", vname))
paste0(
"splines::ns(", vname,
if (length(knots)) paste0(", knots=c(", paste(signif(knots,10), collapse=","), ")") else "",
", Boundary.knots=c(", signif(bnd[1],10), ",", signif(bnd[2],10), ")",
", intercept=FALSE)"
)
}, character(1))
rhs_new <- paste(new_terms, collapse=" + ")
as.formula(paste(lhs, "~", rhs_new), env = parent.frame())
}
rename_ns_to_train <- function(X_names, want){
train_ns <- grep("^ns\\(", want, value = TRUE)
train_map <- list()
if (length(train_ns)) {
vars_tr <- vapply(train_ns, .parse_var_from_ns, "", USE.NAMES = FALSE)
idx_tr  <- vapply(train_ns, .parse_idx_from_ns, NA_integer_, USE.NAMES = FALSE)
for (v in unique(vars_tr[!is.na(vars_tr)])) {
sel <- which(vars_tr == v & !is.na(idx_tr))
ord <- sel[order(idx_tr[sel])]
train_map[[v]] <- train_ns[ord]
}
}
pred_ns <- grep("(^|::)ns\\(", X_names, value = TRUE)
if (!length(pred_ns)) return(X_names)
vars_pr <- vapply(pred_ns, .parse_var_from_ns, "", USE.NAMES = FALSE)
idx_pr  <- vapply(pred_ns, .parse_idx_from_ns, NA_integer_, USE.NAMES = FALSE)
for (v in unique(vars_pr[!is.na(vars_pr)])) {
psel <- which(vars_pr == v & !is.na(idx_pr))
pord <- psel[order(idx_pr[psel])]
pgrp <- pred_ns[pord]
tgrp <- train_map[[v]]
if (length(tgrp)) {
ti <- vapply(tgrp, .parse_idx_from_ns, NA_integer_)
pi <- vapply(pgrp, .parse_idx_from_ns, NA_integer_)
common <- intersect(ti, pi)
if (length(common)) {
for (k in common) {
from <- pgrp[which(pi == k)]
to   <- tgrp[which(ti == k)]
pos  <- match(from, X_names)
if (!is.na(pos) && length(to) == 1) X_names[pos] <- to
}
}
}
}
X_names
}
predict_by_coef <- function(bd, newdata, strict = TRUE, return_debug = TRUE){
stopifnot(is.data.frame(newdata))
if (is.null(bd)) return(list(error="Model bundle is NULL (path missing)."))
df <- .align_factors(newdata, bd$factor_spec)
fml_use <- rebuild_formula_strong(bd)
tt <- terms(fml_use)
mf <- model.frame(stats::delete.response(tt), data = df, na.action = na.omit)
if (nrow(mf) == 0) {
if (return_debug) return(list(prob_14d_death = numeric(0), debug = list(reason="empty model.frame")))
return(numeric(0))
}
Xp <- model.matrix(stats::delete.response(tt), data = mf)
if ("(Intercept)" %in% colnames(Xp)) Xp <- Xp[, setdiff(colnames(Xp), "(Intercept)"), drop = FALSE]
want <- bd$x_names %||% colnames(Xp)
colnames(Xp) <- rename_ns_to_train(colnames(Xp), want)
miss_before  <- setdiff(want, colnames(Xp))
extra_before <- setdiff(colnames(Xp), want)
still_ns_miss <- grep("^ns\\(", miss_before, value = TRUE)
if (strict && length(still_ns_miss)) {
return(list(
error = sprintf("스플라인 열 매핑 실패: %s", paste(still_ns_miss, collapse=", ")),
debug = list(
miss_before = miss_before,
extra_before = extra_before,
want_head = head(want, 30),
X_pred_head = head(colnames(Xp), 30)
)
))
}
if (length(miss_before)) {
add <- matrix(0, nrow = nrow(Xp), ncol = length(miss_before))
colnames(add) <- miss_before
Xp <- cbind(Xp, add)
}
if (length(extra_before)) Xp <- Xp[, setdiff(colnames(Xp), extra_before), drop = FALSE]
Xp <- Xp[:, want, drop = FALSE]
pr("C:/Users/niced/Desktop/TBI_risk_factor_R/소스코드/AJOU_Webpage/api/Plumber_4.R") |>
pr_set_docs(FALSE) |>              # ← Swagger/OpenAPI 비활성화
pr_set_debug(FALSE) |>
pr_run(host="0.0.0.0", port=8000)
library(plumber)
pr("C:/Users/niced/Desktop/TBI_risk_factor_R/소스코드/AJOU_Webpage/api/Plumber_4.R") |>
pr_set_docs(FALSE) |>              # ← Swagger/OpenAPI 비활성화
pr_set_debug(FALSE) |>
pr_run(host="0.0.0.0", port=8000)
pr("C:/Users/niced/Desktop/TBI_risk_factor_R/소스코드/AJOU_Webpage/api/Plumber_4.R") |>
pr_set_docs(FALSE) |>              # ← Swagger/OpenAPI 비활성화
pr_set_debug(FALSE) |>
pr_run(host="0.0.0.0", port=8000)
pr("C:/Users/niced/Desktop/TBI_risk_factor_R/소스코드/AJOU_Webpage/api/Plumber_4.R") |>
pr_set_docs(FALSE) |>              # ← Swagger/OpenAPI 비활성화
pr_set_debug(FALSE) |>
pr_run(host="0.0.0.0", port=8000)
pr("C:/Users/niced/Desktop/TBI_risk_factor_R/소스코드/AJOU_Webpage/api/Plumber_4.R") |>
pr_set_docs(FALSE) |>              # ← Swagger/OpenAPI 비활성화
pr_set_debug(FALSE) |>
pr_run(host="0.0.0.0", port=8000)
library(plumber)
pr("C:/Users/niced/Desktop/TBI_risk_factor_R/소스코드/AJOU_Webpage/api/Plumber_4.R") |>
pr_set_docs(FALSE) |>              # ← Swagger/OpenAPI 비활성화
pr_set_debug(FALSE) |>
pr_run(host="0.0.0.0", port=8000)
library(plumber)
pr("C:/Users/niced/Desktop/TBI_risk_factor_R/소스코드/AJOU_Webpage/api/Plumber_4.R") |>
pr_set_docs(FALSE) |>              # ← Swagger/OpenAPI 비활성화
pr_set_debug(FALSE) |>
pr_run(host="0.0.0.0", port=8000)
library(plumber)
pr("C:/Users/niced/Desktop/TBI_risk_factor_R/소스코드/AJOU_Webpage/api/Plumber_4.R") |>
pr_set_docs(FALSE) |>              # ← Swagger/OpenAPI 비활성화
pr_set_debug(FALSE) |>
pr_run(host="0.0.0.0", port=8000)
bundle
(async () => {
console.clear();
const key = window.currentKey();
